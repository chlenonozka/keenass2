{"ast":null,"code":"import { makeAutoObservable, runInAction } from 'mobx';\nimport http from '../api/http';\nexport class AuthStore {\n  constructor() {\n    this.user = null;\n    this.token = null;\n    this.isLoading = false;\n    this.initializing = true;\n    this.error = null;\n    makeAutoObservable(this);\n    this.hydrate();\n  }\n  get isAuthenticated() {\n    return !!this.token && !!this.user;\n  }\n  get isAdmin() {\n    var _this$user;\n    return ((_this$user = this.user) === null || _this$user === void 0 ? void 0 : _this$user.role) === 'admin';\n  }\n  hydrate() {\n    const token = localStorage.getItem('token');\n    const userRaw = localStorage.getItem('user');\n    this.token = token !== null && token !== void 0 ? token : null;\n    if (userRaw && userRaw !== 'undefined' && userRaw !== 'null') {\n      try {\n        this.user = JSON.parse(userRaw);\n      } catch {\n        localStorage.removeItem('user');\n        this.user = null;\n      }\n    } else {\n      if (userRaw) localStorage.removeItem('user');\n      this.user = null;\n    }\n    this.initializing = false;\n  }\n  async login(dto) {\n    this.isLoading = true;\n    this.error = null;\n    try {\n      const {\n        data\n      } = await http.post('/auth/login', dto);\n      runInAction(() => {\n        this.token = data.token;\n        this.user = data.user;\n        localStorage.setItem('token', data.token);\n        localStorage.setItem('user', JSON.stringify(data.user));\n      });\n    } catch (e) {\n      runInAction(() => {\n        var _e$response, _e$response$data;\n        this.error = (e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message) || 'Ошибка входа';\n      });\n      throw e;\n    } finally {\n      runInAction(() => this.isLoading = false);\n    }\n  }\n  async register(dto) {\n    this.isLoading = true;\n    this.error = null;\n    try {\n      const {\n        data\n      } = await http.post('/auth/register', dto);\n      runInAction(() => {\n        this.token = data.token;\n        this.user = data.user;\n        localStorage.setItem('token', data.token);\n        localStorage.setItem('user', JSON.stringify(data.user));\n      });\n    } catch (e) {\n      runInAction(() => {\n        var _e$response2, _e$response2$data;\n        this.error = (e === null || e === void 0 ? void 0 : (_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : (_e$response2$data = _e$response2.data) === null || _e$response2$data === void 0 ? void 0 : _e$response2$data.message) || 'Ошибка регистрации';\n      });\n      throw e;\n    } finally {\n      runInAction(() => this.isLoading = false);\n    }\n  }\n  logout() {\n    this.token = null;\n    this.user = null;\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n  }\n}","map":{"version":3,"names":["makeAutoObservable","runInAction","http","AuthStore","constructor","user","token","isLoading","initializing","error","hydrate","isAuthenticated","isAdmin","_this$user","role","localStorage","getItem","userRaw","JSON","parse","removeItem","login","dto","data","post","setItem","stringify","e","_e$response","_e$response$data","response","message","register","_e$response2","_e$response2$data","logout"],"sources":["C:/praka/www/media/src/stores/auth.store.ts"],"sourcesContent":["import { makeAutoObservable, runInAction } from 'mobx'\r\nimport http from '../api/http'\r\nimport type { CredentialsDTO, RegisterDTO, User } from '../types'\r\n\r\nexport class AuthStore {\r\n  user: User | null = null\r\n  token: string | null = null\r\n  isLoading = false\r\n  initializing = true\r\n  error: string | null = null\r\n\r\n  constructor() {\r\n    makeAutoObservable(this)\r\n    this.hydrate()\r\n  }\r\n\r\n  get isAuthenticated() {\r\n    return !!this.token && !!this.user\r\n  }\r\n\r\n  get isAdmin() {\r\n    return this.user?.role === 'admin'\r\n  }\r\n\r\n    hydrate() {\r\n    const token = localStorage.getItem('token')\r\n    const userRaw = localStorage.getItem('user')\r\n\r\n    this.token = token ?? null\r\n\r\n    if (userRaw && userRaw !== 'undefined' && userRaw !== 'null') {\r\n        try {\r\n        this.user = JSON.parse(userRaw)\r\n        } catch {\r\n        localStorage.removeItem('user')\r\n        this.user = null\r\n        }\r\n    } else {\r\n        if (userRaw) localStorage.removeItem('user')\r\n        this.user = null\r\n    }\r\n\r\n    this.initializing = false\r\n    }\r\n\r\n\r\n  async login(dto: CredentialsDTO) {\r\n    this.isLoading = true\r\n    this.error = null\r\n    try {\r\n      const { data } = await http.post<{ token: string; user: User }>('/auth/login', dto)\r\n      runInAction(() => {\r\n        this.token = data.token\r\n        this.user = data.user\r\n        localStorage.setItem('token', data.token)\r\n        localStorage.setItem('user', JSON.stringify(data.user))\r\n      })\r\n    } catch (e: any) {\r\n      runInAction(() => {\r\n        this.error = e?.response?.data?.message || 'Ошибка входа'\r\n      })\r\n      throw e\r\n    } finally {\r\n      runInAction(() => (this.isLoading = false))\r\n    }\r\n  }\r\n\r\n  async register(dto: RegisterDTO) {\r\n    this.isLoading = true\r\n    this.error = null\r\n    try {\r\n      const { data } = await http.post<{ token: string; user: User }>('/auth/register', dto)\r\n      runInAction(() => {\r\n        this.token = data.token\r\n        this.user = data.user\r\n        localStorage.setItem('token', data.token)\r\n        localStorage.setItem('user', JSON.stringify(data.user))\r\n      })\r\n    } catch (e: any) {\r\n      runInAction(() => {\r\n        this.error = e?.response?.data?.message || 'Ошибка регистрации'\r\n      })\r\n      throw e\r\n    } finally {\r\n      runInAction(() => (this.isLoading = false))\r\n    }\r\n  }\r\n\r\n  logout() {\r\n    this.token = null\r\n    this.user = null\r\n    localStorage.removeItem('token')\r\n    localStorage.removeItem('user')\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}