{"ast":null,"code":"import { makeAutoObservable, runInAction } from 'mobx';\nimport http, { postFallback } from '../api/http';\nexport class AuthStore {\n  constructor() {\n    this.user = null;\n    this.token = null;\n    this.isLoading = false;\n    this.initializing = true;\n    this.error = null;\n    makeAutoObservable(this);\n    this.hydrate();\n  }\n  get isAuthenticated() {\n    return !!this.token && !!this.user;\n  }\n  get isAdmin() {\n    var _this$user;\n    return ((_this$user = this.user) === null || _this$user === void 0 ? void 0 : _this$user.role) === 'admin';\n  }\n  hydrate() {\n    const token = localStorage.getItem('token');\n    const raw = localStorage.getItem('user');\n    this.token = token !== null && token !== void 0 ? token : null;\n    if (raw && raw !== 'undefined' && raw !== 'null') {\n      try {\n        this.user = JSON.parse(raw);\n      } catch {\n        localStorage.removeItem('user');\n        this.user = null;\n      }\n    } else {\n      if (raw) localStorage.removeItem('user');\n      this.user = null;\n    }\n    this.initializing = false;\n  }\n  async login(dto) {\n    this.isLoading = true;\n    this.error = null;\n    try {\n      const {\n        data\n      } = await postFallback(['/auth', '/auth/login', '/login', '/api/auth/login'], dto);\n      runInAction(() => {\n        this.token = data.token;\n        this.user = data.user;\n        localStorage.setItem('token', data.token);\n        localStorage.setItem('user', JSON.stringify(data.user));\n      });\n    } catch (e) {\n      runInAction(() => {\n        var _e$response, _e$response$data;\n        this.error = (e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message) || 'Ошибка входа';\n      });\n      throw e;\n    } finally {\n      runInAction(() => this.isLoading = false);\n    }\n  }\n  async register(dto) {\n    this.isLoading = true;\n    this.error = null;\n    try {\n      const {\n        data\n      } = await http.post('/register', dto);\n      runInAction(() => {\n        this.token = data.token;\n        this.user = data.user;\n        localStorage.setItem('token', data.token);\n        localStorage.setItem('user', JSON.stringify(data.user));\n      });\n    } catch (e) {\n      runInAction(() => {\n        var _e$response2, _e$response2$data;\n        this.error = (e === null || e === void 0 ? void 0 : (_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : (_e$response2$data = _e$response2.data) === null || _e$response2$data === void 0 ? void 0 : _e$response2$data.message) || 'Ошибка регистрации';\n      });\n      throw e;\n    } finally {\n      runInAction(() => this.isLoading = false);\n    }\n  }\n  logout() {\n    this.token = null;\n    this.user = null;\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n  }\n}","map":{"version":3,"names":["makeAutoObservable","runInAction","http","postFallback","AuthStore","constructor","user","token","isLoading","initializing","error","hydrate","isAuthenticated","isAdmin","_this$user","role","localStorage","getItem","raw","JSON","parse","removeItem","login","dto","data","setItem","stringify","e","_e$response","_e$response$data","response","message","register","post","_e$response2","_e$response2$data","logout"],"sources":["C:/praka/www/media/src/stores/auth.store.ts"],"sourcesContent":["import { makeAutoObservable, runInAction } from 'mobx'\r\nimport http, { postFallback } from '../api/http'\r\nimport type { CredentialsDTO, RegisterDTO, User } from '../types'\r\n\r\nexport class AuthStore {\r\n  user: User | null = null\r\n  token: string | null = null\r\n  isLoading = false\r\n  initializing = true\r\n  error: string | null = null\r\n\r\n  constructor() {\r\n    makeAutoObservable(this)\r\n    this.hydrate()\r\n  }\r\n\r\n  get isAuthenticated() {\r\n    return !!this.token && !!this.user\r\n  }\r\n\r\n  get isAdmin() {\r\n    return this.user?.role === 'admin'\r\n  }\r\n\r\n    hydrate() {\r\n    const token = localStorage.getItem('token')\r\n    const raw = localStorage.getItem('user')\r\n\r\n    this.token = token ?? null\r\n\r\n    if (raw && raw !== 'undefined' && raw !== 'null') {\r\n        try { this.user = JSON.parse(raw) }\r\n        catch { localStorage.removeItem('user'); this.user = null }\r\n    } else {\r\n        if (raw) localStorage.removeItem('user')\r\n        this.user = null\r\n    }\r\n\r\n    this.initializing = false\r\n    }\r\n\r\n\r\n    async login(dto: CredentialsDTO) {\r\n    this.isLoading = true\r\n    this.error = null\r\n    try {\r\n        const { data } = await postFallback<{ token: string; user: User }>(\r\n        ['/auth', '/auth/login', '/login', '/api/auth/login'],\r\n        dto\r\n        )\r\n\r\n        runInAction(() => {\r\n        this.token = data.token\r\n        this.user = data.user\r\n        localStorage.setItem('token', data.token)\r\n        localStorage.setItem('user', JSON.stringify(data.user))\r\n        })\r\n    } catch (e: any) {\r\n        runInAction(() => {\r\n        this.error = e?.response?.data?.message || 'Ошибка входа'\r\n        })\r\n        throw e\r\n    } finally {\r\n        runInAction(() => (this.isLoading = false))\r\n    }\r\n    }\r\n\r\n  async register(dto: RegisterDTO) {\r\n    this.isLoading = true\r\n    this.error = null\r\n    try {\r\n      const { data } = await http.post<{ token: string; user: User }>('/register', dto)\r\n      runInAction(() => {\r\n        this.token = data.token\r\n        this.user = data.user\r\n        localStorage.setItem('token', data.token)\r\n        localStorage.setItem('user', JSON.stringify(data.user))\r\n      })\r\n    } catch (e: any) {\r\n      runInAction(() => {\r\n        this.error = e?.response?.data?.message || 'Ошибка регистрации'\r\n      })\r\n      throw e\r\n    } finally {\r\n      runInAction(() => (this.isLoading = false))\r\n    }\r\n  }\r\n\r\n  logout() {\r\n    this.token = null\r\n    this.user = null\r\n    localStorage.removeItem('token')\r\n    localStorage.removeItem('user')\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}