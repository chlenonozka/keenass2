{"ast":null,"code":"var _jsxFileName = \"C:\\\\praka\\\\www\\\\media\\\\src\\\\components\\\\post\\\\PostForm.tsx\",\n  _s = $RefreshSig$();\nimport { useRef, useState } from 'react';\nimport { observer } from 'mobx-react-lite';\nimport { useRootStore } from '../../stores/root.store';\nimport { Alert, Box, Button, Stack, TextField } from '@mui/material';\nimport Loader from '../loader/Loader';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PostForm = _s(observer(_c = _s(() => {\n  _s();\n  const {\n    posts,\n    auth\n  } = useRootStore();\n  const [description, setDescription] = useState('');\n  const [imageUrl, setImageUrl] = useState(undefined);\n  const [imageName, setImageName] = useState(undefined);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState(null);\n  const inputRef = useRef(null);\n  const pickFile = () => {\n    var _inputRef$current;\n    return (_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.click();\n  };\n  const onFile = async e => {\n    var _e$target$files;\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!file) return;\n    setError(null);\n    try {\n      const {\n        url,\n        name\n      } = await posts.uploadImage(file);\n      setImageUrl(url);\n      setImageName(name);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      setError((err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || (err === null || err === void 0 ? void 0 : err.message) || 'Не удалось загрузить файл');\n    } finally {\n      if (inputRef.current) inputRef.current.value = '';\n    }\n  };\n  const onSubmit = async e => {\n    var _auth$user;\n    e.preventDefault();\n    if (!auth.isAuthenticated) return;\n    if ((_auth$user = auth.user) !== null && _auth$user !== void 0 && _auth$user.isBlocked) {\n      setError('Ваш аккаунт заблокирован');\n      return;\n    }\n    setSaving(true);\n    setError(null);\n    try {\n      await posts.createPost({\n        description,\n        imageUrl,\n        imageName\n      });\n      setDescription('');\n      setImageUrl(undefined);\n      setImageName(undefined);\n    } catch (e) {\n      var _e$response, _e$response$data;\n      setError((e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message) || (e === null || e === void 0 ? void 0 : e.message) || 'Не удалось создать пост');\n    } finally {\n      setSaving(false);\n    }\n  };\n  if (!auth.isAuthenticated) {\n    return /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      children: \"\\u0427\\u0442\\u043E\\u0431\\u044B \\u0441\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u043F\\u043E\\u0441\\u0442, \\u0432\\u043E\\u0439\\u0434\\u0438\\u0442\\u0435 \\u0432 \\u0441\\u0438\\u0441\\u0442\\u0435\\u043C\\u0443\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Box, {\n    component: \"form\",\n    onSubmit: onSubmit,\n    children: /*#__PURE__*/_jsxDEV(Stack, {\n      spacing: 1.5,\n      children: [/*#__PURE__*/_jsxDEV(TextField, {\n        multiline: true,\n        minRows: 2,\n        placeholder: \"\\u041F\\u043E\\u0434\\u0435\\u043B\\u0438\\u0442\\u0435\\u0441\\u044C \\u0447\\u0435\\u043C-\\u043D\\u0438\\u0431\\u0443\\u0434\\u044C...\",\n        value: description,\n        onChange: e => setDescription(e.target.value),\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 9\n      }, this), imageUrl && /*#__PURE__*/_jsxDEV(\"img\", {\n        src: imageUrl,\n        alt: \"preview\",\n        style: {\n          maxWidth: '100%',\n          borderRadius: 12\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Stack, {\n        direction: \"row\",\n        spacing: 1,\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          ref: inputRef,\n          type: \"file\",\n          accept: \"image/*\",\n          hidden: true,\n          onChange: onFile\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"outlined\",\n          onClick: pickFile,\n          children: \"\\u0424\\u043E\\u0442\\u043E\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          type: \"submit\",\n          variant: \"contained\",\n          disabled: saving || !description.trim(),\n          children: saving ? /*#__PURE__*/_jsxDEV(Loader, {\n            inline: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 23\n          }, this) : 'Опубликовать'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 5\n  }, this);\n}, \"QvMaZYVN85vR5oMzgZiThBp3ct4=\", false, function () {\n  return [useRootStore];\n})), \"QvMaZYVN85vR5oMzgZiThBp3ct4=\", false, function () {\n  return [useRootStore];\n});\n_c2 = PostForm;\nexport default PostForm;\nvar _c, _c2;\n$RefreshReg$(_c, \"PostForm$observer\");\n$RefreshReg$(_c2, \"PostForm\");","map":{"version":3,"names":["useRef","useState","observer","useRootStore","Alert","Box","Button","Stack","TextField","Loader","jsxDEV","_jsxDEV","PostForm","_s","_c","posts","auth","description","setDescription","imageUrl","setImageUrl","undefined","imageName","setImageName","saving","setSaving","error","setError","inputRef","pickFile","_inputRef$current","current","click","onFile","e","_e$target$files","file","target","files","url","name","uploadImage","err","_err$response","_err$response$data","response","data","message","value","onSubmit","_auth$user","preventDefault","isAuthenticated","user","isBlocked","createPost","_e$response","_e$response$data","severity","children","fileName","_jsxFileName","lineNumber","columnNumber","component","spacing","multiline","minRows","placeholder","onChange","required","src","alt","style","maxWidth","borderRadius","direction","ref","type","accept","hidden","variant","onClick","disabled","trim","inline","_c2","$RefreshReg$"],"sources":["C:/praka/www/media/src/components/post/PostForm.tsx"],"sourcesContent":["import { useRef, useState } from 'react'\r\nimport { observer } from 'mobx-react-lite'\r\nimport { useRootStore } from '../../stores/root.store'\r\nimport { Alert, Box, Button, Stack, TextField } from '@mui/material'\r\nimport Loader from '../loader/Loader'\r\n\r\nconst PostForm = observer(() => {\r\n  const { posts, auth } = useRootStore()\r\n  const [description, setDescription] = useState('')\r\n  const [imageUrl, setImageUrl] = useState<string | undefined>(undefined)\r\n  const [imageName, setImageName] = useState<string | undefined>(undefined)\r\n  const [saving, setSaving] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const inputRef = useRef<HTMLInputElement>(null)\r\n  const pickFile = () => inputRef.current?.click()\r\n\r\n  const onFile = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0]\r\n    if (!file) return\r\n    setError(null)\r\n    try {\r\n      const { url, name } = await posts.uploadImage(file)\r\n      setImageUrl(url)\r\n      setImageName(name)\r\n    } catch (err: any) {\r\n      setError(err?.response?.data?.message || err?.message || 'Не удалось загрузить файл')\r\n    } finally {\r\n      if (inputRef.current) inputRef.current.value = ''\r\n    }\r\n  }\r\n\r\n  const onSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    if (!auth.isAuthenticated) return\r\n    if (auth.user?.isBlocked) { setError('Ваш аккаунт заблокирован'); return }\r\n    setSaving(true); setError(null)\r\n    try {\r\n      await posts.createPost({ description, imageUrl, imageName })\r\n      setDescription('')\r\n      setImageUrl(undefined)\r\n      setImageName(undefined)\r\n    } catch (e: any) {\r\n      setError(e?.response?.data?.message || e?.message || 'Не удалось создать пост')\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  if (!auth.isAuthenticated) {\r\n    return <Alert severity=\"info\">Чтобы создать пост, войдите в систему</Alert>\r\n  }\r\n\r\n  return (\r\n    <Box component=\"form\" onSubmit={onSubmit}>\r\n      <Stack spacing={1.5}>\r\n        <TextField\r\n          multiline\r\n          minRows={2}\r\n          placeholder=\"Поделитесь чем-нибудь...\"\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n          required\r\n        />\r\n\r\n        {imageUrl && (\r\n          <img src={imageUrl} alt=\"preview\" style={{ maxWidth: '100%', borderRadius: 12 }} />\r\n        )}\r\n\r\n        <Stack direction=\"row\" spacing={1}>\r\n          <input ref={inputRef} type=\"file\" accept=\"image/*\" hidden onChange={onFile} />\r\n          <Button variant=\"outlined\" onClick={pickFile}>Фото</Button>\r\n          <Button type=\"submit\" variant=\"contained\" disabled={saving || !description.trim()}>\r\n            {saving ? <Loader inline/> : 'Опубликовать'}\r\n          </Button>\r\n        </Stack>\r\n\r\n        {error && <Alert severity=\"error\">{error}</Alert>}\r\n      </Stack>\r\n    </Box>\r\n  )\r\n})\r\n\r\nexport default PostForm\r\n"],"mappings":";;AAAA,SAASA,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AACxC,SAASC,QAAQ,QAAQ,iBAAiB;AAC1C,SAASC,YAAY,QAAQ,yBAAyB;AACtD,SAASC,KAAK,EAAEC,GAAG,EAAEC,MAAM,EAAEC,KAAK,EAAEC,SAAS,QAAQ,eAAe;AACpE,OAAOC,MAAM,MAAM,kBAAkB;AAAA,SAAAC,MAAA,IAAAC,OAAA;AAErC,MAAMC,QAAQ,GAAAC,EAAA,CAAGX,QAAQ,CAAAY,EAAA,GAAAD,EAAA,CAAC,MAAM;EAAAA,EAAA;EAC9B,MAAM;IAAEE,KAAK;IAAEC;EAAK,CAAC,GAAGb,YAAY,CAAC,CAAC;EACtC,MAAM,CAACc,WAAW,EAAEC,cAAc,CAAC,GAAGjB,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACkB,QAAQ,EAAEC,WAAW,CAAC,GAAGnB,QAAQ,CAAqBoB,SAAS,CAAC;EACvE,MAAM,CAACC,SAAS,EAAEC,YAAY,CAAC,GAAGtB,QAAQ,CAAqBoB,SAAS,CAAC;EACzE,MAAM,CAACG,MAAM,EAAEC,SAAS,CAAC,GAAGxB,QAAQ,CAAC,KAAK,CAAC;EAC3C,MAAM,CAACyB,KAAK,EAAEC,QAAQ,CAAC,GAAG1B,QAAQ,CAAgB,IAAI,CAAC;EAEvD,MAAM2B,QAAQ,GAAG5B,MAAM,CAAmB,IAAI,CAAC;EAC/C,MAAM6B,QAAQ,GAAGA,CAAA;IAAA,IAAAC,iBAAA;IAAA,QAAAA,iBAAA,GAAMF,QAAQ,CAACG,OAAO,cAAAD,iBAAA,uBAAhBA,iBAAA,CAAkBE,KAAK,CAAC,CAAC;EAAA;EAEhD,MAAMC,MAAM,GAAG,MAAOC,CAAsC,IAAK;IAAA,IAAAC,eAAA;IAC/D,MAAMC,IAAI,IAAAD,eAAA,GAAGD,CAAC,CAACG,MAAM,CAACC,KAAK,cAAAH,eAAA,uBAAdA,eAAA,CAAiB,CAAC,CAAC;IAChC,IAAI,CAACC,IAAI,EAAE;IACXT,QAAQ,CAAC,IAAI,CAAC;IACd,IAAI;MACF,MAAM;QAAEY,GAAG;QAAEC;MAAK,CAAC,GAAG,MAAMzB,KAAK,CAAC0B,WAAW,CAACL,IAAI,CAAC;MACnDhB,WAAW,CAACmB,GAAG,CAAC;MAChBhB,YAAY,CAACiB,IAAI,CAAC;IACpB,CAAC,CAAC,OAAOE,GAAQ,EAAE;MAAA,IAAAC,aAAA,EAAAC,kBAAA;MACjBjB,QAAQ,CAAC,CAAAe,GAAG,aAAHA,GAAG,wBAAAC,aAAA,GAAHD,GAAG,CAAEG,QAAQ,cAAAF,aAAA,wBAAAC,kBAAA,GAAbD,aAAA,CAAeG,IAAI,cAAAF,kBAAA,uBAAnBA,kBAAA,CAAqBG,OAAO,MAAIL,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEK,OAAO,KAAI,2BAA2B,CAAC;IACvF,CAAC,SAAS;MACR,IAAInB,QAAQ,CAACG,OAAO,EAAEH,QAAQ,CAACG,OAAO,CAACiB,KAAK,GAAG,EAAE;IACnD;EACF,CAAC;EAED,MAAMC,QAAQ,GAAG,MAAOf,CAAkB,IAAK;IAAA,IAAAgB,UAAA;IAC7ChB,CAAC,CAACiB,cAAc,CAAC,CAAC;IAClB,IAAI,CAACnC,IAAI,CAACoC,eAAe,EAAE;IAC3B,KAAAF,UAAA,GAAIlC,IAAI,CAACqC,IAAI,cAAAH,UAAA,eAATA,UAAA,CAAWI,SAAS,EAAE;MAAE3B,QAAQ,CAAC,0BAA0B,CAAC;MAAE;IAAO;IACzEF,SAAS,CAAC,IAAI,CAAC;IAAEE,QAAQ,CAAC,IAAI,CAAC;IAC/B,IAAI;MACF,MAAMZ,KAAK,CAACwC,UAAU,CAAC;QAAEtC,WAAW;QAAEE,QAAQ;QAAEG;MAAU,CAAC,CAAC;MAC5DJ,cAAc,CAAC,EAAE,CAAC;MAClBE,WAAW,CAACC,SAAS,CAAC;MACtBE,YAAY,CAACF,SAAS,CAAC;IACzB,CAAC,CAAC,OAAOa,CAAM,EAAE;MAAA,IAAAsB,WAAA,EAAAC,gBAAA;MACf9B,QAAQ,CAAC,CAAAO,CAAC,aAADA,CAAC,wBAAAsB,WAAA,GAADtB,CAAC,CAAEW,QAAQ,cAAAW,WAAA,wBAAAC,gBAAA,GAAXD,WAAA,CAAaV,IAAI,cAAAW,gBAAA,uBAAjBA,gBAAA,CAAmBV,OAAO,MAAIb,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEa,OAAO,KAAI,yBAAyB,CAAC;IACjF,CAAC,SAAS;MACRtB,SAAS,CAAC,KAAK,CAAC;IAClB;EACF,CAAC;EAED,IAAI,CAACT,IAAI,CAACoC,eAAe,EAAE;IACzB,oBAAOzC,OAAA,CAACP,KAAK;MAACsD,QAAQ,EAAC,MAAM;MAAAC,QAAA,EAAC;IAAqC;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAO,CAAC;EAC7E;EAEA,oBACEpD,OAAA,CAACN,GAAG;IAAC2D,SAAS,EAAC,MAAM;IAACf,QAAQ,EAAEA,QAAS;IAAAU,QAAA,eACvChD,OAAA,CAACJ,KAAK;MAAC0D,OAAO,EAAE,GAAI;MAAAN,QAAA,gBAClBhD,OAAA,CAACH,SAAS;QACR0D,SAAS;QACTC,OAAO,EAAE,CAAE;QACXC,WAAW,EAAC,yHAA0B;QACtCpB,KAAK,EAAE/B,WAAY;QACnBoD,QAAQ,EAAGnC,CAAC,IAAKhB,cAAc,CAACgB,CAAC,CAACG,MAAM,CAACW,KAAK,CAAE;QAChDsB,QAAQ;MAAA;QAAAV,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACT,CAAC,EAED5C,QAAQ,iBACPR,OAAA;QAAK4D,GAAG,EAAEpD,QAAS;QAACqD,GAAG,EAAC,SAAS;QAACC,KAAK,EAAE;UAAEC,QAAQ,EAAE,MAAM;UAAEC,YAAY,EAAE;QAAG;MAAE;QAAAf,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CACnF,eAEDpD,OAAA,CAACJ,KAAK;QAACqE,SAAS,EAAC,KAAK;QAACX,OAAO,EAAE,CAAE;QAAAN,QAAA,gBAChChD,OAAA;UAAOkE,GAAG,EAAEjD,QAAS;UAACkD,IAAI,EAAC,MAAM;UAACC,MAAM,EAAC,SAAS;UAACC,MAAM;UAACX,QAAQ,EAAEpC;QAAO;UAAA2B,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,eAC9EpD,OAAA,CAACL,MAAM;UAAC2E,OAAO,EAAC,UAAU;UAACC,OAAO,EAAErD,QAAS;UAAA8B,QAAA,EAAC;QAAI;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eAC3DpD,OAAA,CAACL,MAAM;UAACwE,IAAI,EAAC,QAAQ;UAACG,OAAO,EAAC,WAAW;UAACE,QAAQ,EAAE3D,MAAM,IAAI,CAACP,WAAW,CAACmE,IAAI,CAAC,CAAE;UAAAzB,QAAA,EAC/EnC,MAAM,gBAAGb,OAAA,CAACF,MAAM;YAAC4E,MAAM;UAAA;YAAAzB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAC,CAAC,GAAG;QAAc;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACrC,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACJ,CAAC,EAEPrC,KAAK,iBAAIf,OAAA,CAACP,KAAK;QAACsD,QAAQ,EAAC,OAAO;QAAAC,QAAA,EAAEjC;MAAK;QAAAkC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC5C;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEV,CAAC;EAAA,QA1EyB5D,YAAY;AAAA,EA0ErC,CAAC;EAAA,QA1EwBA,YAAY;AAAA,EA0EpC;AAAAmF,GAAA,GA3EI1E,QAAQ;AA6Ed,eAAeA,QAAQ;AAAA,IAAAE,EAAA,EAAAwE,GAAA;AAAAC,YAAA,CAAAzE,EAAA;AAAAyE,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}